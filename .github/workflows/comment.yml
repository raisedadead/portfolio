name: Comment

on:
  workflow_call:
    inputs:
      url:
        description: 'The URL to comment on the PR'
        required: true
        type: string
      deployment_id:
        description: 'The ID of the deployment'
        required: true
        type: string
      alias:
        description: 'The alias of the deployment'
        required: true
        type: string
      environment:
        description: 'The environment of the deployment'
        required: true
        type: string
      issue-number:
        description: 'The issue number to comment on'
        required: true
        type: string

jobs:
  comment:
    runs-on: ubuntu-latest

    steps:
      - name: Find Previous Comment
        uses: peter-evans/find-comment@81e2da3af01c92f83cb927cf3ace0e085617c556 # v2
        id: fc
        with:
          issue-number: ${{ inputs.issue-number }}
          comment-author: 'github-actions[bot]'
          body-includes: 'Deployed to Cloudflare Pages'

      - name: Comment previous step output on Pull Request
        uses: peter-evans/create-or-update-comment@5adcb0bb0f9fb3f95ef05400558bdb3f329ee808 # v2
        with:
          comment-id: ${{ steps.fc.outputs.comment-id }}
          edit-mode: replace
          issue-number: ${{ inputs.issue-number }}
          body: |
            #### Deployed to Cloudflare Pages:

            **[`${{ inputs.url }}`](${{ inputs.url }})**

            <details>
            <summary>More details: </summary>

            | Step          | Status |
            | :----         | :------ |
            | Deployment Id | ${{ inputs.deployment_id }} |
            | URL Alias     | ${{ inputs.alias }} |
            | URL           | ${{ inputs.url }} |
            | Environment   | ${{ inputs.environment }} |

            </details>
