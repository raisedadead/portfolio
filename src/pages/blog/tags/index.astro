---
// Tags index page - lists all unique tags from blog posts
import { getCollection } from 'astro:content';
import MainLayout from '@/layouts/main-layout.astro';
import { getAllTags } from '@/lib/blog-utils';
import { cn } from '@/lib/utils';

// Fetch all blog posts and extract unique tags
const allPosts = await getCollection('blog');
const allTags = getAllTags(allPosts);
---

<MainLayout pageTitle='Blog Tags' pageDescription='Browse all blog posts organized by tags'>
  <section class={cn('mb-2')}>
    <div class={cn('prose prose-lg prose-slate max-w-none')}>
      <h1 class={cn('py-4 text-center text-3xl font-bold text-slate-800')}>Blog Tags</h1>
    </div>
  </section>

  <section class={cn('mb-12')}>
    <p class={cn('pb-6 text-center text-lg text-slate-600')}>Browse posts by topic</p>

    {
      allTags.length === 0 ? (
        <div class={cn('mx-auto max-w-md rounded-lg border-2 border-dashed border-slate-300 p-12 text-center')}>
          <p class={cn('text-lg text-slate-600')}>No tags found yet. Check back soon!</p>
        </div>
      ) : (
        <div class={cn('grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3')}>
          {allTags.map((tag) => {
            // Count posts with this tag
            const postCount = allPosts.filter((post) =>
              post.data.tags.some((postTag) => postTag.slug === tag.slug)
            ).length;

            return (
              <a
                href={`/blog/tags/${tag.slug}`}
                class={cn(
                  'group block border-4 border-black bg-white p-6 no-underline shadow-[6px_6px_0px_var(--color-black)] transition-all duration-100 hover:bg-orange-100 hover:shadow-[8px_8px_0px_var(--color-black)] dark:border-orange-200 dark:bg-gray-800 dark:hover:bg-orange-900'
                )}
              >
                <div class={cn('flex items-center justify-between')}>
                  <h2
                    class={cn(
                      'text-xl font-bold text-slate-800 group-hover:text-orange-800 dark:text-orange-100 dark:group-hover:text-orange-200'
                    )}
                  >
                    {tag.name}
                  </h2>
                  <span
                    class={cn(
                      'rounded-full bg-slate-200 px-3 py-1 text-sm font-medium text-slate-700 dark:bg-slate-700 dark:text-slate-300'
                    )}
                  >
                    {postCount}
                  </span>
                </div>
                <p class={cn('mt-2 text-sm text-slate-600 dark:text-slate-400')}>
                  {postCount} {postCount === 1 ? 'post' : 'posts'}
                </p>
              </a>
            );
          })}
        </div>
      )
    }
    <div class='flex justify-center py-8'>
      <a href='/blog'> ‚Üê Back to blog </a>
    </div>
  </section>
</MainLayout>
